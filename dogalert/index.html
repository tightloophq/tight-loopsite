
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dog Alert</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0b0b0f;
      color: #eaeaf0;
      display: flex;
      height: 100vh;
    }
    #controls {
      width: 320px;
      padding: 16px;
      background: #12131a;
      border-right: 1px solid #232538;
      overflow-y: auto;
    }
    #map {
      flex: 1;
    }
    h1 {margin-top: 0;font-size: 1.4rem;}
    label {display:block;margin-top:10px;font-size:0.9rem;}
    input, select, textarea, button {
      width: 100%;
      margin-top: 4px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #35384a;
      background: #1f2230;
      color: #eaeaf0;
    }
    button {cursor:pointer;font-weight:600;}
    button:hover {filter:brightness(1.1);}
    /* Stripe Floating Bar */
    #stripeBar{position:fixed;left:0;right:0;bottom:16px;z-index:9999;display:flex;justify-content:center;pointer-events:none}
    #stripeBar .sb-wrap{pointer-events:auto;display:flex;gap:16px;align-items:center;background:#0b0b0f;border:1px solid #2a2a36;border-radius:14px;padding:10px 14px;box-shadow:0 8px 24px rgba(0,0,0,.4);max-width:560px;width:calc(100% - 24px)}
    #stripeBar strong{color:#eaeaf0;font-weight:700;letter-spacing:.2px}
    #stripeBar .sb-actions{margin-left:auto;display:flex;gap:10px}
    #stripeBar .sb-btn{display:inline-block;text-decoration:none;padding:8px 14px;border-radius:10px;background:#1f2230;border:1px solid #35384a;color:#eaeaf0;font-weight:600}
    #stripeBar .sb-btn:hover{filter:brightness(1.1)}
    #stripeBar .sb-btn.sb-pro{background:#2b3a18;border-color:#3e5a1a}
    @media (max-width:520px){
      #stripeBar .sb-wrap{gap:10px}
      #stripeBar strong{font-size:.95rem}
      #stripeBar .sb-btn{padding:8px 12px}
    }
  </style>
</head>
<body>
  <div id="controls">
    <h1>Dog Alert</h1>
    <form id="reportForm">
      <label>Breed
        <select id="breed">
          <option value="Unknown">Unknown</option>
          <option value="Pitbull">Pitbull</option>
          <option value="German Shepherd">German Shepherd</option>
          <option value="Rottweiler">Rottweiler</option>
          <option value="Bulldog">Bulldog</option>
          <option value="Husky">Husky</option>
        </select>
      </label>
      <label>Type
        <select id="type">
          <option value="Loose">Loose</option>
          <option value="Mean">Mean</option>
          <option value="Vicious">Vicious</option>
        </select>
      </label>
      <label>Description
        <textarea id="description" rows="3"></textarea>
      </label>
      <label>Image
        <input type="file" id="image" accept="image/*" />
      </label>
      <button type="submit">Submit Report</button>
    </form>
  </div>
  <div id="map"></div>

  <!-- Stripe Floating Bar -->
  <div id="stripeBar">
    <div class="sb-wrap">
      <strong>Dog Alert</strong>
      <div class="sb-actions">
        <a href="https://buy.stripe.com/test_5kQ3cveQYgMD9IzdPW9oc00" target="_blank" rel="noopener" class="sb-btn">Basic</a>
        <a href="https://buy.stripe.com/test_6oU14nbEMeEv9Iz4fm9oc0" target="_blank" rel="noopener" class="sb-btn sb-pro">Pro</a>
      </div>
    </div>
  </div>

  <script type="module">
    // Firebase config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let map;

    async function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 51.0447, lng: -114.0719 },
        zoom: 12,
        mapId: "DEMO_MAP_ID"
      });

      // Load pins from Firestore
      const querySnapshot = await getDocs(collection(db, "reports"));
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        addMarker(data);
      });
    }

    function addMarker(data) {
      const marker = new google.maps.Marker({
        position: { lat: data.lat, lng: data.lng },
        map: map
      });

      const content = `
        <div>
          <strong>${data.breed} (${data.type})</strong><br>
          ${data.description || ""}
          ${data.image ? `<br><img src="${data.image}" width="120"/>` : ""}
        </div>`;
      const infowindow = new google.maps.InfoWindow({ content });
      marker.addListener("click", () => infowindow.open(map, marker));
    }

    document.getElementById("reportForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const breed = document.getElementById("breed").value;
      const type = document.getElementById("type").value;
      const description = document.getElementById("description").value;
      const file = document.getElementById("image").files[0];

      let base64Image = "";
      if (file) {
        base64Image = await toBase64(file);
      }

      const position = map.getCenter();

      const docRef = await addDoc(collection(db, "reports"), {
        breed, type, description,
        lat: position.lat(),
        lng: position.lng(),
        image: base64Image
      });
      console.log("Report saved:", docRef.id);

      addMarker({ breed, type, description, lat: position.lat(), lng: position.lng(), image: base64Image });
      e.target.reset();
    });

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = (error) => reject(error);
      });
    }

    window.initMap = initMap;
  </script>
  <script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>
</body>
</html>
